<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>eCSSential | test template</title>
		
		<!-- CSS -->
		<!-- if we have JS, let's only load the CSS that will apply on this screen, and better yet, defer the load of any CSS that won't apply in the current viewport width -->
		<script>
			/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license */
			window.matchMedia=window.matchMedia||function(a,b){var c,d=a.documentElement,e=d.firstElementChild||d.firstChild,f=a.createElement("body"),g=a.createElement("div");return g.id="mq-test-1",g.style.cssText="position:absolute;top:-100em",f.style.background="none",f.appendChild(g),function(a){return g.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',d.insertBefore(f,e),c=g.offsetWidth==42,d.removeChild(f),{matches:c,media:a}}}(document)

			/*! eCSSential.js: An experiment in optimized loading of mobile-first responsive CSS. [c]2012 @scottjehl, MIT/GPLv2 */
			window.eCSSential=function(a,b){var c=[],d=[],e=window,f=e.document,g=b&&0&&e.navigator.appVersion.match(/MSIE [678]\./);for(var h in a)a.hasOwnProperty(h)&&(g||e.matchMedia(h).matches?c.push(a[h]):e.matchMedia(h.replace(/(min)(\-width)/,"$1-device$2")).matches&&d.push(a[h]));c.length&&f.write('<link rel="stylesheet" href="'+c.join(",")+'=concat">'),f.write('<meta id="eCCS">');if(d.length){var i=f.createElement("link"),j=f.getElementById("eCCS");i.rel="stylesheet",i.href=d.join(",")+"=concat",j.parentNode.insertBefore(i,j)}};
			
			//Go! Load CSS now/later/never by passing in object of stylesheet hrefs with breakpoint min-width keys
			eCSSential({ 
				"all": "_css/all.css",
				"(min-width: 20em)": "_css/min-20em.css",
				"(min-width: 37.5em)": "_css/min-37.5em.css",
				"(min-width: 50em)": "_css/min-50em.css",
				"(min-width: 62.5em)": "_css/min-62.5em.css"
			}, true );
			
		</script>
		<!-- no JS? Load css for all breakpoints, or just the initial breakpoint - up to you... -->
		<noscript><link href="_css/all.css,_css/min-20em.css,_css/min-37.5em.css,_css/min-50em.css,_css/min-62.5em.css=concat" rel="stylesheet"></noscript>
		<!-- /CSS -->
		</head>
	<body>
		<h1> eCSSential</h1>
		<p>An experiment in optimized loading of mobile-first responsive CSS.</p>
		<p>[c]2012 @scottjehl, MIT/GPLv2</p>
		
		<p><strong>Explanation:</strong> Loading CSS in an optimized or prioritized fashion is very difficult. In order for a website to load cleanly, all CSS needed for rendering that page layout must be referenced in the <code>head</code> of a document. This is because stylesheets loaded in this way will block page rendering until they are loaded and ready to apply. If a stylesheet is referenced later in a document, or even loaded dynamically via JS, users will often see a <abbr title="flash of unstyled content">FOUC</abbr> while that stylesheet loads concurrently with page rendering. Unfortunately, working within this limitation can make for a lot of overhead on large-scale responsive designs, particularly if a stylesheet contains a large amount of CSS for breakpoints that don't currently apply at a particular viewport size, or worse, won't ever apply on a particular device. More unfortunate, using separate <code>link</code> elements with <code>media</code> attributes to reference stylesheets with their intended breakpoints doesn't prevent those stylesheets from downloading or blocking page rendering, even in environments where they don't currently or will never apply, and it also creates more HTTP requests.</p>
		
		<p>This experiment uses a teeny bit of inline JavaScript to determine which of a set of stylesheets should be loaded immediately to allow for clean rendering (any stylesheets intended for  mobile-first breakpoints that currently apply), which stylesheets should be deferred to load asynchronously (any breakpoints that don't currently apply to the current viewport size, but could apply later, given the device's screen size), and which stylesheets should never be loaded at all. Once sorted, the CSS payload is delivered in 2 concatenated requests (with the help of quickconcat.php): the first request is immediate and blocking (synchronous), and the second, deferred and non-blocking (asynchronous).</p>
		
		<p>If you're in a desktop browser, you can check the console to see which stylesheets were loaded immediately and which were deferred; changing your viewport/window width and reloading the page will change where this split occurs.</p>
		
		<p>In non-JS environments, this optimized loading won't apply, but nonetheless, all available stylesheets will load via a single concatenated request (which is a current best-practice approach to loading CSS, anyway).</p>
		
		<p class="explain">Each stylesheet will add a line of text below to announce its presence and whether its intended breakpoint is currently active. Note that this script is merely concerned with improving stylesheet loading performance, but how and where those loaded stylesheets apply is still controlled by CSS media queries.</p>
		
		<!-- just some example elements for the various CSS files to populate and make their presence/visibility known -->
		<p class="a"></p>
		<p class="b"></p>
		<p class="c"></p>
		<p class="d"></p>
		<p class="e"></p>
	</body>
</html>
